{
 "add_total_row": 0,
 "columns": [],
 "creation": "2024-08-07 13:40:18.491910",
 "disabled": 0,
 "docstatus": 0,
 "doctype": "Report",
 "filters": [],
 "idx": 0,
 "is_standard": "Yes",
 "javascript": "frappe.query_reports['Supplier Delivery Performance'] = {\r\n    \"filters\": [\r\n        {\r\n            \"fieldname\": \"from_date\",\r\n            \"label\": __(\"From Date\"),\r\n            \"fieldtype\": \"Date\",\r\n            \"default\": frappe.datetime.add_months(frappe.datetime.now_date(), -1),\r\n            \"reqd\": 1\r\n        },\r\n        {\r\n            \"fieldname\": \"to_date\",\r\n            \"label\": __(\"To Date\"),\r\n            \"fieldtype\": \"Date\",\r\n            \"default\": frappe.datetime.now_date(),\r\n            \"reqd\": 1\r\n        }\r\n    ]\r\n};\r\n\r\n }\r\n",
 "letter_head": "Vaaman Engineers",
 "letterhead": null,
 "modified": "2024-08-07 13:47:40.617245",
 "modified_by": "Administrator",
 "module": "Bid Management",
 "name": "Supplier Delivery Performance",
 "owner": "Administrator",
 "prepared_report": 0,
 "ref_doctype": "Purchase Receipt",
 "report_name": "Supplier Delivery Performance",
 "report_script": "def execute(filters=None):\r\n    columns, data = [], []\r\n\r\n    # Define the columns\r\n    columns = [\r\n        {\"label\": \"Supplier\", \"fieldname\": \"supplier\", \"fieldtype\": \"Link\", \"options\": \"Supplier\", \"width\": 200},\r\n        {\"label\": \"Average Delivery Delay\", \"fieldname\": \"avg_delivery_delay\", \"fieldtype\": \"Float\", \"width\": 150},\r\n        {\"label\": \"Total Orders\", \"fieldname\": \"total_orders\", \"fieldtype\": \"Int\", \"width\": 100},\r\n        {\"label\": \"Completed Orders\", \"fieldname\": \"completed_orders\", \"fieldtype\": \"Int\", \"width\": 120}\r\n    ]\r\n\r\n    # Fetch the data\r\n    data = get_supplier_performance_data(filters)\r\n\r\n    return columns, data\r\n\r\ndef get_supplier_performance_data(filters):\r\n    # Validate date filters\r\n    if not filters.get(\"from_date\") or not filters.get(\"to_date\"):\r\n        frappe.throw(\"Please set From Date and To Date\")\r\n\r\n    # Perform the query\r\n    query = \"\"\"\r\n        SELECT\r\n            po.supplier AS supplier,\r\n            AVG(DATEDIFF(pr.posting_date, poi.schedule_date)) AS avg_delivery_delay,\r\n            COUNT(DISTINCT po.name) AS total_orders,\r\n            SUM(CASE WHEN po.status = 'Completed' THEN 1 ELSE 0 END) AS completed_orders\r\n        FROM\r\n            `tabPurchase Receipt` pr\r\n        JOIN\r\n            `tabPurchase Order Item` poi ON poi.parent = pr.purchase_order\r\n        JOIN\r\n            `tabPurchase Order` po ON po.name = poi.parent\r\n        WHERE\r\n            pr.posting_date BETWEEN %(from_date)s AND %(to_date)s\r\n        GROUP BY\r\n            po.supplier\r\n        ORDER BY\r\n            avg_delivery_delay ASC\r\n    \"\"\"\r\n\r\n    # Execute query and fetch data\r\n    result = frappe.db.sql(query, filters, as_dict=True)\r\n    return result\r\n",
 "report_type": "Script Report",
 "roles": []
}